#第十四节课
##一.虚拟内存
###1.问题：
　　尽管基址寄存器和界限寄存器可以用于创建地址空间的抽象，还有一个问题需要解决即软件管理的膨胀：软件增长速度远远大于硬件增长速度
###2.解决方法:
　　20世纪60年代采用的解决方法是把程序分割成许多片段，称为覆盖技术。覆盖技术虽然由系统完成实际的覆盖块换入换出操作，但程序员必须把程序分割成多个片段，这个过程非常费时并且枯燥，并且易于出错。很快有人找到一个新方法，即：虚拟内存
###3.虚拟内存的基本思想：
　　每个程序拥有自己的地址空间，这个空间被分割成多个块，每一块称作一页或页面。每一页有连续的地址范围。这些页被映射到物理内存，但不是所有的页都必须在内存中才能运行程序。当程序引用到一部分在物理内存中的地址空间时，由硬件立即执行必要的映射，当程序引用到一部分不在物理内存中的地址空间时，由操作系统负责将缺少的部分装入物理内存并重新执行失败的指令。
##二.分页
###1.分页的概念：
　　大部分虚拟内存系统中都使用一种称为分页的技术。

　　分页是指在任何一台计算机上，程序引用了一组内存地址。

　　分页的大小按进程字节长度来定。
###2.虚拟地址空间的使用：
　　在没有虚拟内存的计算机上，系统直接将虚拟地址送到地址总线上，读写操作使用相同地址的物理内存字；

　　在使用虚拟内存的情况下，虚拟地址不是直接送到地址总线上，而是被送到内存管理单元（MMU）,MMU把内存地址映射为物理内存地址。

![MMU的位置和功能](anli/Markdown/blob/master/MMU的位置和功能.PNG)                       
###3.页框的概念：
　　虚拟地址空间按照固定大小划分成称为页面的若干单元。

　　在物理内存中对应的单元称为页框。

    （注意，虚拟地址的长度和实际地址的长度一样）
##三.页表
###1.虚拟地址到物理地址的映射
　　虚拟地址到物理地址的映射可以概括如下：虚拟地址被分成虚拟页号（高位部分）和偏移量（低位部分）
###2.页表项的结构

![一个典型的页表项](juanli/Markdown/blob/master/一个典型的页表项.PNG)

    1.页框号：页映射的目的是找到页框号
    2.在/不在位：这一位是1时表示该表项是有效的，可以使用；如果是0，则表示该表项对应的虚拟页面现在不在内存中，访问该页面会引起一个缺页中断。
    3.保护：指出一个页允许什么类型的访问。
    4.高速缓存禁止位：禁止该页面被高速缓存。
##四.加速分页过程
###1.问题：
　　在任何分页式问题中，都必须考虑两个主要问题

      虚拟地址到物理地址的映射必须非常快
      如果虚拟地址空间很大，页表也会很大
###2.解决方法：
　　将虚拟地址直接映射到物理地址，而不必再访问页表这种设备称为转换检测缓存区（TLB）
##五.针对大内存的页表
###1.多级页表：
　　一般内存比页表小，但当页表足够多，内存足够大时，为了避免把全部页表一直保存在内存中。采用多级页表。
###2.倒排页表：
　　随着64位计算机变得更加普遍。64位分页虚拟地址空间的系统需要一个不同于多级页表的解决放案，即倒排页表。
